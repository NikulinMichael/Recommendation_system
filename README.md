# Recommendation_system
## Описание проекта

Cервиса рекомендательной системы постов в условной социальной сети.


Структура репозитория

```buildoutcfg
|   README.md
|   request-examples.txt    <- Примеры запросов к сервису
|   requirements.txt    <- Модули Python, необходимые для корректной работы проекта
|   app.py    <- Актуальная версия приложения
|   schema.py    <- Схема, определяющая формат ответов сервиса
|
├───Dev_notebooks
│       Разработка_классический_ML.ipynb     <- Ноутбук с процессом разработки модели на классическом ML
|       
├───Models
│       catboost_model.cbm   <- ML-модель (она же "контрольная")
```

## Начало работы :white_check_mark:  
Чтобы начать работу с этим проектом, вам нужно клонировать репозиторий и установить [Python 3.12.4](https://www.python.org/downloads/) в вашей системе.  
  
### Клонирование репозитория :inbox_tray:
Выполните следующую команду, чтобы клонировать репозиторий:  

```
git clone https://github.com/NikulinMichael/Recommendation_system.git  
```

### Установка зависимостей :wrench: 
Перейдите в каталог проекта:
```
cd Recommendation_system
```

Создайте виртуальное окружение:
```
python -m venv venv
```

Активируйте виртуальное окружение:
```
venv\Scripts\activate
```

Установите зависимости:
```
pip install -r requirements.txt
```
## Запуск сервиса
Чтобы запустить приложение, выполните следующую команду:
```
python.exe -m uvicorn app:app
```

Сервис доступен по http://127.0.0.1:8000/post/recommendations/
Примеры запросов [здесь](request_examples.txt).



# Описание хода работы над проектом
### Исходные данные
##### Пользователи сервиса
| Поле      | Описание                        |
|-----------|---------------------------------|
| age       | Возраст                         |
| city      | Город                           |
| country   | Страна                          |
| exp_group | Экспериментальная группа        |
| gender    | Пол                             |
| id        | Идентификатор                   |
| os        | Операционная система устройства |
| source    | Источник трафика                |
Количество зарегистрированных пользователей: ~163 тысячи

##### Новостные посты
| Поле  | Описание      |
|-------|---------------|
| id    | Идентификатор |
| text  | Текст         |
| topic | Тематика      |
Количество постов: ~7 тысяч

##### Логи действий пользователей с постами ленты
| Поле      | Описание                                 |
|-----------|------------------------------------------|
| timestamp | Время                                    |
| user_id   | id пользователя                          |
| post_id   | id поста                                 |
| action    | Совершённое действие - просмотр или лайк |
| target    | Поставлен ли лайк **после** просмотра.   |
Количество записей: ~77 миллионов

### Описание задачи

Необходимо создать готовый к интеграции веб-сервис, возвращающий по запросу зарегистрированного
пользователя персонализированную ленту новостей.

##### Параметры запроса
| Поле  | Описание                  |
|-------|---------------------------|
| id    | id пользователя           |
| time  | Время запроса             |
| limit | Количество постов в ленте |

##### Параметры отклика (одного поста из ленты)
| Поле  | Описание    |
|-------|-------------|
| id    | id поста    |
| text  | Текст поста |
| topic | Тема поста  |

##### Метрика
Оценка качества обученных алгоритмов будет замеряться по метрике hitrate@5 - есть ли хотя бы один лайк от пользователя в показанной ему ленте.

$$\text{HitRate}@5 = \frac{\text{Количество попаданий в топ-5}}{\text{Общее количество запросов}}$$

##### Технические требования и принятые допущения
1. Время отклика сервиса на 1 запрос не должен превышать 0.5 секунд.
2. Сервис не должен занимать более 2 Гб памяти системы.
3. Набор пользователей и постов фиксирован.
4. Временные рамки подаваемых сервису запросов ограничены предельными значениями в логах действий пользователей.

## Описание решения

### Анализ данных
При разведочном анализе данных препятствием стал размер датасета логов пользователей - 77 миллионов строк.
С целью уменьшить потребляемую память из базы данных было выгружено 5 миллионов записей.

### Выбор алгоритма решения
Так как сервис должен иметь возможность давать рекомендации двумя различными моделями, 
необходимо сделать и обосновать выбор.
1. Рекомендационную модель на методе классического ML решено обучать с помощью CatBoostClassifier.
Данный выбор обоснован табличной сущностью данных и необходимостью ранжировать полученные моделью предсказания.
Так как целевым показателем для нас является получение like хотя бы у одного поста в выдаче (согласно метрике hitrate@5),
ранжировать предсказания будем по вероятностям, полученными в классификаторе.
2. Вторая модель представляет собой тот же CatboostClassifier с обучением на полученных с помощью DL эмбеддингами текстов постов. Эмбеддинги текстов получены с помощью эмбеддингов слов, в свою очередь полученных с помощью предобученной Distil-Bert модели с дальнейшими преобразованиями.

### Реализация сервиса
Сервис реализован с помощью FastAPI в виде endpoint:
1. По POST запросу принимается запрос от пользователя на выдачу ленты.
2. Полученный в запросе JSON обрабатывается, все необходимые признаки приводятся к требуемой для модели форме.
3. Модель делает предсказания для каждого поста и выбираются с наибольшей вероятностью получающие лайк.
4. Сервис возвращает отклик со списком рекомендованных постов.

### Итоговые метрики
1. Среднее значение hitrate@5 в _контрольной_ группе: **0.580**

### Выводы
Реализован веб-сервис, по POST запросу id пользователя возвращающий ленту постов.
